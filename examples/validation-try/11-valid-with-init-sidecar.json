{
  "name": "app-with-init-sidecar",
  "namespace": "default",
  "version": "1.0.0",
  "project": "demo-project",
  "description": "Application with init container and sidecar",
  "component": [
    {
      "name": "backend",
      "type": "webservice",
      "image": "myregistry/backend:v1.0.0",
      "namespace": "default",
      "replicas": 2,
      "properties": {
        "ports": [{"port": 8080}]
      },
      "traits": {
        "init": [
          {
            "name": "init-config",
            "properties": {
              "image": "busybox:latest",
              "command": ["sh", "-c", "cp /config/* /app/config/"]
            },
            "traits": {
              "storage": [
                {
                  "type": "config",
                  "name": "app-config",
                  "source_name": "my-configmap",
                  "mount_path": "/config",
                  "read_only": true
                },
                {
                  "type": "ephemeral",
                  "name": "shared-data",
                  "mount_path": "/app/config"
                }
              ]
            }
          }
        ],
        "sidecar": [
          {
            "name": "logging-sidecar",
            "image": "fluent/fluentd:v1.14",
            "env": {
              "FLUENTD_CONF": "fluent.conf"
            },
            "traits": {
              "storage": [
                {
                  "type": "ephemeral",
                  "name": "app-logs",
                  "mount_path": "/var/log/app"
                }
              ],
              "resources": {
                "cpu": "100m",
                "memory": "128Mi"
              }
            }
          }
        ],
        "storage": [
          {
            "type": "ephemeral",
            "name": "app-logs",
            "mount_path": "/var/log/app"
          }
        ]
      }
    }
  ],
  "workflow": [
    {
      "name": "deploy",
      "mode": "StepByStep",
      "components": ["backend"]
    }
  ]
}


