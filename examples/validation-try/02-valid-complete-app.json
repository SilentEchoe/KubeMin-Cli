{
  "name": "demo-app",
  "namespace": "default",
  "version": "1.0.0",
  "project": "demo-project",
  "description": "Complete demo application with all traits",
  "component": [
    {
      "name": "app-config",
      "type": "config",
      "namespace": "default",
      "replicas": 1,
      "properties": {
        "conf": {
          "database.host": "mysql.default.svc",
          "database.port": "3306",
          "log.level": "info"
        }
      },
      "traits": {}
    },
    {
      "name": "app-secret",
      "type": "secret",
      "namespace": "default",
      "replicas": 1,
      "properties": {
        "secret": {
          "db.password": "secret123",
          "api.key": "my-api-key"
        }
      },
      "traits": {}
    },
    {
      "name": "mysql",
      "type": "store",
      "image": "mysql:8.0",
      "namespace": "default",
      "replicas": 1,
      "properties": {
        "ports": [{"port": 3306}],
        "env": {
          "MYSQL_ROOT_PASSWORD": "root123"
        }
      },
      "traits": {
        "storage": [
          {
            "type": "persistent",
            "name": "mysql-data",
            "mount_path": "/var/lib/mysql",
            "tmp_create": true,
            "size": "10Gi",
            "storage_class": "standard"
          }
        ],
        "probes": [
          {
            "type": "liveness",
            "tcp_socket": {
              "port": 3306
            },
            "initial_delay_seconds": 30,
            "period_seconds": 10
          },
          {
            "type": "readiness",
            "tcp_socket": {
              "port": 3306
            },
            "initial_delay_seconds": 5,
            "period_seconds": 5
          }
        ]
      }
    },
    {
      "name": "backend",
      "type": "webservice",
      "image": "myregistry/backend:v1.0.0",
      "namespace": "default",
      "replicas": 3,
      "properties": {
        "ports": [{"port": 8080}],
        "env": {
          "APP_ENV": "production"
        }
      },
      "traits": {
        "probes": [
          {
            "type": "liveness",
            "http_get": {
              "path": "/healthz",
              "port": 8080
            },
            "initial_delay_seconds": 30,
            "period_seconds": 10,
            "timeout_seconds": 5,
            "failure_threshold": 3
          },
          {
            "type": "readiness",
            "http_get": {
              "path": "/ready",
              "port": 8080
            },
            "initial_delay_seconds": 5,
            "period_seconds": 5
          }
        ],
        "resources": {
          "cpu": "500m",
          "memory": "512Mi"
        },
        "env_from": [
          {
            "type": "configMap",
            "source_name": "app-config"
          },
          {
            "type": "secret",
            "source_name": "app-secret"
          }
        ],
        "envs": [
          {
            "name": "POD_NAME",
            "value_from": {
              "field": "metadata.name"
            }
          },
          {
            "name": "POD_IP",
            "value_from": {
              "field": "status.podIP"
            }
          }
        ],
        "ingress": [
          {
            "name": "backend-ingress",
            "namespace": "default",
            "ingress_class_name": "nginx",
            "hosts": ["api.example.com"],
            "routes": [
              {
                "path": "/api",
                "path_type": "Prefix",
                "backend": {
                  "service_name": "backend",
                  "service_port": 8080
                }
              }
            ]
          }
        ],
        "rbac": [
          {
            "service_account": "backend-sa",
            "rules": [
              {
                "api_groups": [""],
                "resources": ["pods", "services"],
                "verbs": ["get", "list", "watch"]
              },
              {
                "api_groups": [""],
                "resources": ["configmaps"],
                "verbs": ["get"]
              }
            ]
          }
        ]
      }
    }
  ],
  "workflow": [
    {
      "name": "config-step",
      "mode": "StepByStep",
      "components": ["app-config", "app-secret"]
    },
    {
      "name": "database-step",
      "mode": "DAG",
      "components": ["mysql"]
    },
    {
      "name": "services-step",
      "mode": "DAG",
      "components": ["backend"]
    }
  ]
}


