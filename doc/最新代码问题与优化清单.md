## 最新代码问题与优化清单（中文）
 
### 1）HTTP 服务缺少优雅关闭与完整超时
- 问题：仅设置 ReadHeaderTimeout，未设置 ReadTimeout/WriteTimeout/IdleTimeout；未在关闭时调用 Shutdown。
- 优化：增加全部超时并在 ctx 取消时优雅关闭。
 
### 2）工作流写库忽略调用方上下文
- 位置：WorkflowCtl.updateWorkflowTask 使用 context.Background()。
- 优化：改为传入 ctx，支持取消与超时。
 
### 3）Deployment/StatefulSet 等待逻辑对临时错误过于敏感
- 问题：k8s API 临时错误直接返回失败，未重试。
- 优化：对可恢复错误重试，保留超时/取消为终止条件。
 
### 4）Redis 客户端未配置拨号/读写超时
- 优化：在 redis.Options 中设置 DialTimeout/ReadTimeout/WriteTimeout。
 
### 5）队列消费在连续错误时缺少退避
- 优化：对 ReadGroup/AutoClaim 连续错误使用指数退避，避免忙等。
 
### 6）workers 启动幂等可再加固
- 建议：可用 sync.Once/atomic 强化在角色频繁切换时的并发安全（当前风险低）。
 
### 7）HTTP 下载工具可选放宽 2xx 状态
- 现状：仅接受 200；可选改为接受 2xx 或可配置。
 
### 8）MySQL 连接池已正确设置
- 结论：此前担忧为旧判断；可额外校验 DSN parseTime=true 等。
 
### 9）Traits 处理器反射逻辑健壮
- 结论：已做 nil 判定与类型分支，保持不变。
 
### 10）工作流失败时的错误传播
- 优化：将失败原因上报到 errChan 或统一错误处理，以便可观测性。
